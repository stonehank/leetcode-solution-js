### 480. 滑动窗口中位数

难度：Hard

相关话题：`Sliding Window`

中位数是有序序列最中间的那个数。如果序列的大小是偶数，则没有最中间的数；此时中位数是最中间的两个数的平均数。



例如：



 `[2,3,4]` ，中位数是 `3` 



 `[2,3]` ，中位数是  `(2 + 3) / 2 = 2.5` 



给出一个数组 nums，有一个大小为 *k*  的窗口从最左端滑动到最右端。窗口中有 k 个数，每次窗口移动 1 位。你的任务是找出每次窗口移动后得到的新窗口中元素的中位数，并输出由它们组成的数组。



例如：



给出*nums*  =  `[1,3,-1,-3,5,3,6,7]` ，以及*k*  = 3。



```

窗口位置                      中位数
---------------               -----
[1  3  -1] -3  5  3  6  7       1
 1 [3  -1  -3] 5  3  6  7       -1
 1  3 [-1  -3  5] 3  6  7       -1
 1  3  -1 [-3  5  3] 6  7       3
 1  3  -1  -3 [5  3  6] 7       5
 1  3  -1  -3  5 [3  6  7]      6
```


因此，返回该滑动窗口的中位数数组 `[1,-1,-1,3,5,6]` 。



**提示：** 
假设 `k` 是合法的，即： `k`  始终小于输入的非空数组的元素个数.




-----

思路：

通过`二分法`进行添加和删除，构造一个长度为`k`有序数组，最终时间复杂度是`O(nk)`。

```
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number[]}
 */
var medianSlidingWindow = function(nums, k) {
  let pq=[]
  function findMid(){
    let mid=(pq.length-1)/2
    return (pq[Math.ceil(mid)]+pq[Math.floor(mid)])/2
  }
  function insert(n){
    if(pq.length===0 || pq[pq.length-1]<=n){
      pq.push(n)
    }else{
      let idx=bsEnd(pq,n)
      pq.splice(idx,0,n)
    }
  }
  function bsEnd(arr,n){
    let lo=0,hi=arr.length-1
    while(lo<hi){
      let mid=Math.floor((lo+hi)/2)
      if(arr[mid]<n)lo=mid+1
      else hi=mid
    }
    return hi
  }
  function remove(n){
    let idx=bsEnd(pq,n)
    pq.splice(idx,1)
  }
  
  for(let i=0;i<k;i++){
    insert(nums[i])
  }
  let res=[]
  res.push(findMid())
  for(let i=k;i<nums.length;i++){
    remove(nums[i-k])
    insert(nums[i])
    res.push(findMid())
  }
  return res
};
```

